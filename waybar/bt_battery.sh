#!/bin/bash

# –ò—â–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ —è–≤–ª—è–µ—Ç—Å—è –≥–∞—Ä–Ω–∏—Ç—É—Ä–æ–π –∏–ª–∏ –Ω–∞—É—à–Ω–∏–∫–∞–º–∏
# upower -e | grep -E 'headset|headphone'
DEVICE_PATH=$(upower -e | grep -E 'headset|headphone' | head -n 1)

# –ï—Å–ª–∏ –ø—É—Ç—å –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã—Ö–æ–¥–∏–º
if [ -z "$DEVICE_PATH" ]; then
    exit 0
fi

# –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞—Ä—è–¥–∞ –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
BATTERY_LEVEL=$(upower -i $DEVICE_PATH | grep "percentage:" | awk '{print $2}' | tr -d '%')

# –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞ –ø–æ–ª—É—á–µ–Ω, –≤—ã–≤–æ–¥–∏–º JSON
if [ -n "$BATTERY_LEVEL" ]; then
    echo "{\"text\": \"üéß ${BATTERY_LEVEL}%\", \"tooltip\": \"–ù–∞—É—à–Ω–∏–∫–∏: ${BATTERY_LEVEL}%\", \"class\": \"plugged\"}"
else
    # –ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã—Ö–æ–¥–∏–º
    exit 0
fi
